<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Interface</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <h2>Admin Registration</h2>
    <form id="registerForm">
      <input
        type="text"
        id="registerUsername"
        placeholder="Username"
        required
      />
      <input
        type="password"
        id="registerPassword"
        placeholder="Password"
        required
      />
      <button type="submit">Register</button>
    </form>

    <h2>Admin Login</h2>
    <form id="loginForm">
      <input type="text" id="loginUsername" placeholder="Username" required />
      <input
        type="password"
        id="loginPassword"
        placeholder="Password"
        required
      />
      <button type="submit">Login</button>
    </form>

    <h3>Token: <span id="tokenDisplay"></span></h3>

    <button id="fetchStudents">Fetch Students</button>

    <div id="studentData"></div>

    <script>
      // Register Admin
      $("#registerForm").submit(function (e) {
        e.preventDefault();
        const username = $("#registerUsername").val();
        const password = $("#registerPassword").val();

        $.ajax({
          url: "/api/auth/register", // Adjust this URL if needed
          type: "POST",
          data: { username, password },
          success: function (data) {
            alert("Registration successful!");
            $("#registerUsername").val("");
            $("#registerPassword").val("");
          },
          error: function (err) {
            alert("Error: " + err.responseText);
          },
        });
      });

      // Login Admin and store token
      $("#loginForm").submit(function (e) {
        e.preventDefault();
        const username = $("#loginUsername").val();
        const password = $("#loginPassword").val();

        $.ajax({
          url: "/api/auth/login", // Adjust this URL if needed
          type: "POST",
          data: { username, password },
          success: function (data) {
            $("#tokenDisplay").text(data.token); // Display the token
            alert("Login successful!");
            $("#loginUsername").val("");
            $("#loginPassword").val("");
          },
          error: function (err) {
            alert("Error: " + err.responseText);
          },
        });
      });

      // Fetch students (CRUD read operation) using the JWT token
      $("#fetchStudents").click(function () {
        const token = $("#tokenDisplay").text(); // Get token from display

        if (!token) {
          alert("You must log in first!");
          return;
        }

        $.ajax({
          url: "/api/students", // Adjust this URL to match your API
          type: "GET",
          headers: { Authorization: `Bearer ${token}` }, // Attach JWT token
          success: function (data) {
            let html = "<h3>Student Data:</h3><ul>";
            data.forEach((student) => {
              html += `<li>${student.name} - ${student.email}</li>`;
            });
            html += "</ul>";
            $("#studentData").html(html); // Display student data
          },
          error: function (err) {
            console.error("Error fetching students:", err);
            alert("Error fetching students");
          },
        });
      });
    </script>
  </body>
</html>
